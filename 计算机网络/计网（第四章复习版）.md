### 第四章 网络层

#### 一、网络层概述

网络层负责在不同网络之间转发数据包，确保数据能够从源主机正确传输到目的主机。

#### 二、子网划分与IP地址

- **编址的第一阶段（重点）**：
  - 分类的IP地址：
    - <img src=".\img\计网（复习版）\IP分类范围.png" alt="IP分类范围" style="zoom: 75%;" />
  - 无分类编址CIDR：
    - 将网络前缀都相同的连续的IP地址组成一个“CIDR地址块”，直到CIDR地址块中的任何一个地址，就可以直到该地址块的全部细节
      - 例题1：<img src=".\img\计网（复习版）\4例题1.png" alt="例题1" style="zoom: 75%;" />
      - 例题2：<img src=".\img\计网（复习版）\4例题2.png" alt="例题2" style="zoom: 75%;" />
    - 应用：地址块-路由聚合（构造超网） **找共同前缀**：如下例题，找出这5个目的网络地址的共同前缀，前几个字节都是相同的，从第三个字节开始不同
      - 例题1：<img src=".\img\计网（复习版）\4例题3.png" alt="例题3" style="zoom: 75%;" />
      - 例题2：<img src=".\img\计网（复习版）\4例题4.png" alt="例题4" style="zoom: 75%;" />
- 编址的第二阶段：划分子网的IPv4地址
  - **子网掩码**：用于区分IP地址中的网络号和主机号。
  - **默认地址掩码**：
    - A类：255.0.0.0
    - B类：255.255.0.0
    - A类地址：255.255.255.0
  - **网络地址（网络号+子网号）** = （二进制的IP地址）AND（地址掩码）
  - 例题：
    - 例题1：<img src=".\img\计网（复习版）\4例题5.png" alt="例题5" style="zoom: 75%;" />
    - 例题2：<img src=".\img\计网（复习版）\4例题6.png" alt="例题6" style="zoom: 75%;" />
      - （A.CIDR表示是/23，说明前23位是网络地址，后9位是主机地址）

#### 三、ARP地址解析协议

- **ARP**：将IP地址转换为MAC地址的协议。
- **映射表**：存储IP地址到MAC地址的映射，动态更新。
- **工作流程**：
  - 主机发送ARP请求以获取目的主机的MAC地址。
  - 目的主机响应ARP请求，提供其MAC地址。
  - 主机更新ARP缓存。

#### 四、ICMP网际控制报文协议

- **ICMP**：用于传递错误消息和操作信息。
- **差错报告报文**：终点不可达、源点抑制、时间超过、参数问题、改变路由。
- **询问报文**：回送请求或回答、时间戳请求或回答。
- **Traceroute命令**：跟踪数据包从源到目的地的路径。
- **PING命令**：测试两个主机之间的连通性。

#### 五、路由协议

- **RIP**：基于距离向量的路由协议，选择最短路由。